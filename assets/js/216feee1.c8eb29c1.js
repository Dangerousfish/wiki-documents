"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[25848],{15680:(e,t,n)=>{n.d(t,{xA:()=>u,yg:()=>g});var a=n(96540);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=d(n),m=i,g=c["".concat(l,".").concat(m)]||c[m]||p[m]||r;return n?a.createElement(g,s(s({ref:t},u),{},{components:n})):a.createElement(g,s({ref:t},u))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[c]="string"==typeof e?e:i,s[1]=o;for(var d=2;d<r;d++)s[d]=n[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},92197:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var a=n(9668),i=(n(96540),n(15680));const r={description:"XIAO ESP32S3(Sense) With FreeRTOS",title:"XIAO ESP32S3(Sense) With FreeRTOS",keywords:["Software","FreeRtos","sd","camera"],image:"https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png",slug:"/xiao-esp32s3-freertos",last_update:{date:"09/14/2024",author:"Priyanshu Roy"}},s="XIAO ESP32S3(Sense) With FreeRTOS",o={unversionedId:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3/XIAO-ESP32S3-FreeRTOS",id:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3/XIAO-ESP32S3-FreeRTOS",title:"XIAO ESP32S3(Sense) With FreeRTOS",description:"XIAO ESP32S3(Sense) With FreeRTOS",source:"@site/docs/Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3/XIAO-ESP32S3-FreeRTOS.md",sourceDirName:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3",slug:"/xiao-esp32s3-freertos",permalink:"/xiao-esp32s3-freertos",draft:!1,editUrl:"https://github.com/Seeed-Studio/wiki-documents/blob/docusaurus-version/docs/Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3/XIAO-ESP32S3-FreeRTOS.md",tags:[],version:"current",lastUpdatedBy:"Priyanshu Roy",lastUpdatedAt:1726272e3,formattedLastUpdatedAt:"Sep 14, 2024",frontMatter:{description:"XIAO ESP32S3(Sense) With FreeRTOS",title:"XIAO ESP32S3(Sense) With FreeRTOS",keywords:["Software","FreeRtos","sd","camera"],image:"https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png",slug:"/xiao-esp32s3-freertos",last_update:{date:"09/14/2024",author:"Priyanshu Roy"}},sidebar:"ProductSidebar",previous:{title:"XIAO ESP32S3(sense) With Zephyr(RTOS)",permalink:"/xiao_esp32s3_zephyr_rtos"},next:{title:"XIAO ESP32S3 with MicroPython",permalink:"/xiao_esp32s3_with_micropython"}},l={},d=[{value:"What is FreeRTOS",id:"what-is-freertos",level:2},{value:"FreeRTOS ports",id:"freertos-ports",level:2},{value:"Hardware Preparation",id:"hardware-preparation",level:2},{value:"Additional Components",id:"additional-components",level:3},{value:"Software Preparation",id:"software-preparation",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Setting up ESP-IDF",id:"setting-up-esp-idf",level:3},{value:"What are Task?",id:"what-are-task",level:2},{value:"What are task properties?",id:"what-are-task-properties",level:3},{value:"Creating a task",id:"creating-a-task",level:3},{value:"Creating a task pinned to a core",id:"creating-a-task-pinned-to-a-core",level:3},{value:"Task function call",id:"task-function-call",level:3},{value:"Visualization of tasks",id:"visualization-of-tasks",level:2},{value:"Visual Representation",id:"visual-representation",level:3},{value:"Code",id:"code",level:3},{value:"Creating the CPU0 and CPU1 Task Schedule",id:"creating-the-cpu0-and-cpu1-task-schedule",level:3},{value:"CPU0 Task Schedule",id:"cpu0-task-schedule",level:4},{value:"CPU1 Task Schedule",id:"cpu1-task-schedule",level:4},{value:"Sensor polling using FreeRTOS",id:"sensor-polling-using-freertos",level:2},{value:"Hardware Setup",id:"hardware-setup",level:3},{value:"Software Setup",id:"software-setup",level:3},{value:"Code Overview",id:"code-overview",level:3},{value:"Key Components:",id:"key-components",level:4},{value:"Output",id:"output",level:3},{value:"Camera and SdCard usage in FreeRTOS",id:"camera-and-sdcard-usage-in-freertos",level:2},{value:"Hardware Setup",id:"hardware-setup-1",level:3},{value:"Software Setup",id:"software-setup-1",level:3},{value:"Camera Component",id:"camera-component",level:3},{value:"SdCard Component",id:"sdcard-component",level:3},{value:"Main Function",id:"main-function",level:3},{value:"Output",id:"output-1",level:3},{value:"UART Output",id:"uart-output",level:4},{value:"Output Image",id:"output-image",level:4},{value:"FreeRtos for Arduino IDE",id:"freertos-for-arduino-ide",level:2},{value:"Hardware Setup",id:"hardware-setup-2",level:3},{value:"Software Setup",id:"software-setup-2",level:3},{value:"Output",id:"output-2",level:3},{value:"Serial Monitor Output",id:"serial-monitor-output",level:3},{value:"Arduino FreeRtos vs ESP-IDF FreeRtos",id:"arduino-freertos-vs-esp-idf-freertos",level:2},{value:"Trouble Shooting",id:"trouble-shooting",level:2},{value:"Tech Support &amp; Product Discussion",id:"tech-support--product-discussion",level:2}],u={toc:d},c="wrapper";function p(e){let{components:t,...n}=e;return(0,i.yg)(c,(0,a.A)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"xiao-esp32s3sense-with-freertos"},"XIAO ESP32S3(Sense) With FreeRTOS"),(0,i.yg)("p",null,"This wiki covers ",(0,i.yg)("a",{parentName:"p",href:"https://freertos.org/"},"FreeRTOS")," support for the ",(0,i.yg)("a",{parentName:"p",href:"https://wiki.seeedstudio.com/xiao_esp32s3_getting_started/"},"Seeed Studio XIAO ESP32S3"),". With the assistance of this guide you will be able to utilize the feature set available to the board."),(0,i.yg)("h2",{id:"what-is-freertos"},"What is ",(0,i.yg)("a",{parentName:"h2",href:"https://www.freertos.org/index.html"},"FreeRTOS")),(0,i.yg)("p",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/1.png",alt:"pir",width:600,height:"auto"})),(0,i.yg)("p",null,"FreeRTOS is a collection of C libraries comprised of a real-time kernel and a set of modular libraries that implement complementary functionality. The FreeRTOS kernel is a real-time kernel (or real-time scheduler) that enables applications built on FreeRTOS to meet their hard real-time requirements. It enables applications to be organized as a collection of independent threads of execution."),(0,i.yg)("p",null,(0,i.yg)("em",{parentName:"p"},"Reference : ",(0,i.yg)("a",{parentName:"em",href:"https://www.freertos.org/Documentation/02-Kernel/07-Books-and-manual/01-RTOS_book"},(0,i.yg)("strong",{parentName:"a"},"Mastering the FreeRTOS Real Time Kernel")))),(0,i.yg)("h2",{id:"freertos-ports"},"FreeRTOS ports"),(0,i.yg)("p",null,"FreeRTOS is an open source RTOS (real-time operating system) kernel that is integrated into ESP-IDF as a component. Thus, all ESP-IDF applications and many ESP-IDF components are written based on FreeRTOS. The FreeRTOS kernel is ported to all architectures (i.e., Xtensa and RISC-V) available of ESP chips."),(0,i.yg)("p",null,"We will be using the ESP IDF port of the FreeRTOS."),(0,i.yg)("h2",{id:"hardware-preparation"},"Hardware Preparation"),(0,i.yg)("p",null,"I am using ",(0,i.yg)("a",{parentName:"p",href:"https://wiki.seeedstudio.com/xiao_esp32s3_getting_started/"},"Seed Studio XIAO ESP32S3 Sense")," and the onboard camera, microphone and sd-card reader along with the Wifi functionality of the ESP32S3."),(0,i.yg)("div",{class:"table-center"},(0,i.yg)("table",{align:"center"},(0,i.yg)("tr",null,(0,i.yg)("th",null,"Seeed Studio XIAO ESP32S3(Sense)")),(0,i.yg)("tr",null,(0,i.yg)("td",null,(0,i.yg)("div",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/xiaoesp32s3sense.jpg",style:{width:250,height:"auto"}})))),(0,i.yg)("tr",null,(0,i.yg)("td",null,(0,i.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,i.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/XIAO-ESP32S3-Sense-p-5639.html"},(0,i.yg)("strong",null,(0,i.yg)("span",null,(0,i.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f"))))))))),(0,i.yg)("h3",{id:"additional-components"},"Additional Components"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://www.seeedstudio.com/Seeeduino-XIAO-Expansion-board-p-4746.html"},"Grove - Expansion Board")," - I2C Display RTC & Button"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://www.seeedstudio.com/Grove-Air-Quality-Sensor-v1-3-Arduino-Compatible.html"},"Air Quality Sensor v1.3")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://www.seeedstudio.com/Grove-Temperature-Humidity-Pressure-and-Gas-Sensor-for-Arduino-BME680.html"},"Grove - Temperature, Humidity, Pressure and Gas Sensor for Arduino - BME680")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://www.seeedstudio.com/XIAO-p-4812.html"},"Acrylic Case for Seeed Studio XIAO Expansion board"))),(0,i.yg)("h2",{id:"software-preparation"},"Software Preparation"),(0,i.yg)("p",null,"I am using Visual Studio Code (Windows) with ESP-IDF."),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"VSCode install"),(0,i.yg)("li",{parentName:"ol"},"ESP-IDF installation guide"),(0,i.yg)("li",{parentName:"ol"},"Git Repository")),(0,i.yg)("div",{class:"table-center"},(0,i.yg)("table",{align:"center"},(0,i.yg)("tr",null,(0,i.yg)("th",null,"VS Code"),(0,i.yg)("th",null,"ESP-IDF for VSCode")),(0,i.yg)("tr",null,(0,i.yg)("td",null,(0,i.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,i.yg)("a",{class:"get_one_now_item",href:"https://code.visualstudio.com/download"},(0,i.yg)("strong",null,(0,i.yg)("span",null,(0,i.yg)("font",{color:"FFFFFF",size:"4"}," Download VSCode\u23ec")))))),(0,i.yg)("td",null,(0,i.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,i.yg)("a",{class:"get_one_now_item",href:"https://github.com/espressif/vscode-esp-idf-extension/blob/master/docs/tutorial/install.md"},(0,i.yg)("strong",null,(0,i.yg)("span",null,(0,i.yg)("font",{color:"FFFFFF",size:"4"}," ESP-IDF Install \u23ec"))))))))),(0,i.yg)("h2",{id:"getting-started"},"Getting Started"),(0,i.yg)("h3",{id:"setting-up-esp-idf"},"Setting up ESP-IDF"),(0,i.yg)("p",null,"After setting up the ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/espressif/vscode-esp-idf-extension/blob/master/docs/tutorial/install.md"},"Visual Studio Extension"),", open the terminal and paste the following command to access the ESP-IDF Command Line Tools from the normal terminal environment(outside of VScode)."),(0,i.yg)("admonition",{type:"note"},(0,i.yg)("p",{parentName:"admonition"},"The normal installation of ",(0,i.yg)("a",{parentName:"p",href:"https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/index.html"},"ESP-IDF")," extension of VS-Code will take care of 90% of use cases do the following steps only if you need ESP Command line tools outside of the environment.")),(0,i.yg)("p",null,"PowerShell (Windows)"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},".$HOME\\esp\\v5.3\\esp-idf\\export.ps1\n")),(0,i.yg)("admonition",{type:"info"},(0,i.yg)("p",{parentName:"admonition"},'".$HOME\\esp\\v5.3\\esp-idf" may differ from user to user.This the default installation path.',(0,i.yg)("br",{parentName:"p"}),"\n","Replace it wil the installation path on your device.")),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"To avoid repeated setup boot up PowerShell in administrator mode and type the following command"),(0,i.yg)("pre",{parentName:"admonition"},(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"notepad $PSHOME\\Profile.ps1\n")),(0,i.yg)("p",{parentName:"admonition"},"A Notepad instance will open up. Paste the export shell command in the note-pad and save it.\nopen an instance of powershell and it should have close to the following output."),(0,i.yg)("pre",{parentName:"admonition"},(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"Done! You can now compile ESP-IDF projects.\n"))),(0,i.yg)("p",null,"If everything is done properly, the following command :"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"idf.py\n")),(0,i.yg)("p",null,"should show the following output :"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"Usage: idf.py [OPTIONS] COMMAND1 [ARGS]... [COMMAND2 [ARGS]...]...\n\n  ESP-IDF CLI build management tool. For commands that are not known to idf.py an attempt to execute it as a build\n  system target will be made. Selected target: None\n")),(0,i.yg)("h2",{id:"what-are-task"},"What are Task?"),(0,i.yg)("p",null,"Tasks are small functions/ jobs that the the processor is requested to perform with a set of settings. Tasks can range from small functions to infinite looping functions.",(0,i.yg)("br",{parentName:"p"}),"\n","Tasks are the fundamental units of execution in an ESP-IDF application. They are essentially functions that run concurrently with other tasks. This allows for efficient multitasking and responsiveness."),(0,i.yg)("h3",{id:"what-are-task-properties"},"What are task properties?"),(0,i.yg)("p",null,"Due to the vastness of this topic, i will be only covering a few of the properties we will be using for this guide."),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"TaskFunction"),": This is the function that contains the actual logic of the task. It's the entry point for the task's execution."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"StackSize"),": This specifies the amount of memory allocated for the task's stack. The stack is used to store local variables, function return addresses, and temporary data."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"TaskPriority"),": This determines the relative importance of the task compared to other tasks. Higher-priority tasks have a greater chance of being executed before lower-priority ones."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"TaskParameters"),": These are optional arguments that can be passed to the task function when it's created. They can be used to provide additional context or configuration to the task."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"CoreAffinity"),": This specifies which CPU core the task should be assigned to. In systems with multiple cores, this can be used to optimize performance or balance the workload.")),(0,i.yg)("h3",{id:"creating-a-task"},"Creating a task"),(0,i.yg)("p",null,"To create a task in FreeRTOS, the xTaskCreate function is used. This function takes several parameters, including the task function, task name, stack size, parameters, priority, and a handle to the created task."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},'TaskHandle_t task;\nxTaskCreate(\n        taskFunction,             /* Function that implements the task. */\n        "taskName",               /* Text name for the task. */\n        configMINIMAL_STACK_SIZE, /* Stack size in words, or bytes. */\n        NULL,                     /* Parameter passed into the task. */\n        tskIDLE_PRIORITY,         /* Priority at which the task is created. */\n        &task                     /* Used to pass out the created task\'s handle. */\n        );\n')),(0,i.yg)("h3",{id:"creating-a-task-pinned-to-a-core"},"Creating a task pinned to a core"),(0,i.yg)("p",null,"To create a task and pin it to a specific core (only if the chip in use is dual core), the xTaskCreatePinnedToCore function is used. This function is similar to xTaskCreate but includes an additional parameter for specifying the core."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},'TaskHandle_t task;\nxTaskCreatePinnedToCore(\n        taskFunction,             /* Function that implements the task. */\n        "taskName",               /* Text name for the task. */\n        configMINIMAL_STACK_SIZE, /* Stack size in words, or bytes. */\n        NULL,                     /* Parameter passed into the task. */\n        tskIDLE_PRIORITY,         /* Priority at which the task is created. */\n        &task,                    /* Used to pass out the created task\'s handle. */\n        0);                       /* Core ID */\n')),(0,i.yg)("h3",{id:"task-function-call"},"Task function call"),(0,i.yg)("p",null,"The task function is the actual code that will be executed by the task."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},"void taskFunction(void * pvParameters) {\n  /*\n  Function definition goes here\n  */\n}\n")),(0,i.yg)("h2",{id:"visualization-of-tasks"},"Visualization of tasks"),(0,i.yg)("p",null,"I am creating four simple task to visualize how the FreeRTOS works."),(0,i.yg)("p",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/2.png",alt:"pir",width:700,height:"auto"})),(0,i.yg)("h3",{id:"visual-representation"},"Visual Representation"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"CPU0\n-----\ntaskFunction1 (1000ms delay)\n\nCPU1\n-----\ntaskFunction2 (500ms delay)\ntaskFunction3 (500ms delay)\ntaskFunction4 (500ms delay)\n")),(0,i.yg)("h3",{id:"code"},"Code"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},'#include <stdio.h>\n#include "freertos/FreeRTOS.h"\n#include "freertos/task.h"\n#include "sdkconfig.h"\n#include "esp_log.h"\n\nTaskHandle_t task1,task2,task3,task4;\n\nvoid taskFunction1(void * pvParameters) {\n    while (true) {\n        ESP_LOGI("Task1", "Hello from task 1");\n        vTaskDelay(pdMS_TO_TICKS(1000)); // Add a delay to avoid overwhelming the output\n    }\n}\n\nvoid taskFunction2(void * pvParameters) {\n    while (true) {\n        ESP_LOGI("Task2", "Hello from task 2");\n        vTaskDelay(pdMS_TO_TICKS(500)); // Add a delay to avoid overwhelming the output\n    }\n}\n\nvoid taskFunction3(void * pvParameters) {\n    while (true) {\n        ESP_LOGI("Task3", "Hello from task 3");\n        vTaskDelay(pdMS_TO_TICKS(500)); // Add a delay to avoid overwhelming the output\n    }\n}\n\nvoid taskFunction4(void * pvParameters) {\n    while (true) {\n        ESP_LOGI("Task4", "Hello from task 4");\n        vTaskDelay(pdMS_TO_TICKS(500)); // Add a delay to avoid overwhelming the output\n    }\n}\n\nvoid app_main(void) {\n    xTaskCreatePinnedToCore(\n        taskFunction1, /* Function that implements the task. */\n        "task_1",        /* Text name for the task. */\n        configMINIMAL_STACK_SIZE, /* Stack size in words, not bytes. */\n        NULL,            /* Parameter passed into the task. */\n        tskIDLE_PRIORITY, /* Priority at which the task is created. */\n        &task1,         /* Used to pass out the created task\'s handle. */\n        0);              /* Core ID */\n\n    xTaskCreatePinnedToCore(\n        taskFunction2, /* Function that implements the task. */\n        "task_2",        /* Text name for the task. */\n        configMINIMAL_STACK_SIZE, /* Stack size in words, not bytes. */\n        NULL,            /* Parameter passed into the task. */\n        tskIDLE_PRIORITY, /* Priority at which the task is created. */\n        &task2,         /* Used to pass out the created task\'s handle. */\n        1);              /* Core ID */\n\n    xTaskCreatePinnedToCore(\n        taskFunction3, /* Function that implements the task. */\n        "task_3",        /* Text name for the task. */\n        configMINIMAL_STACK_SIZE, /* Stack size in words, not bytes. */\n        NULL,            /* Parameter passed into the task. */\n        tskIDLE_PRIORITY, /* Priority at which the task is created. */\n        &task3,         /* Used to pass out the created task\'s handle. */\n        1);              /* Core ID */\n\n    xTaskCreatePinnedToCore(\n        taskFunction4, /* Function that implements the task. */\n        "task_4",        /* Text name for the task. */\n        configMINIMAL_STACK_SIZE, /* Stack size in words, not bytes. */\n        NULL,            /* Parameter passed into the task. */\n        tskIDLE_PRIORITY, /* Priority at which the task is created. */\n        &task4,         /* Used to pass out the created task\'s handle. */\n        1);              /* Core ID */\n}\n')),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"configMINIMAL_STACK_SIZE can be changed in sdkconfig.")),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Four Tasks: The code defines four tasks: taskFunction1, taskFunction2, taskFunction3, and taskFunction4."),(0,i.yg)("li",{parentName:"ol"},"Task Priorities: All tasks are created with the tskIDLE_PRIORITY. This means they have the same priority."),(0,i.yg)("li",{parentName:"ol"},"Task Pinning: taskFunction1 is pinned to CPU0, while the other three tasks are pinned to CPU1."),(0,i.yg)("li",{parentName:"ol"},"Task Delays: taskFunction1 has a delay of 1000ms, while the other three have a delay of 500ms.")),(0,i.yg)("h3",{id:"creating-the-cpu0-and-cpu1-task-schedule"},"Creating the CPU0 and CPU1 Task Schedule"),(0,i.yg)("p",null,"I have create a basic task schedule for CPU0 and CPU1."),(0,i.yg)("h4",{id:"cpu0-task-schedule"},"CPU0 Task Schedule"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"Task: taskFunction1\nPriority: Idle (lowest)\nDelay: 1000ms\nCore: 0\n")),(0,i.yg)("h4",{id:"cpu1-task-schedule"},"CPU1 Task Schedule"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"Tasks: taskFunction2, taskFunction3, taskFunction4\nPriorities: All Idle (same priority)\nDelays: 500ms for all tasks\nCore: 1\n")),(0,i.yg)("admonition",{type:"info"},(0,i.yg)("p",{parentName:"admonition"},"This is a simplified schedule. Actual task scheduling in a real-time system would involve more complex factors like task priorities, deadlines, and resource constraints.")),(0,i.yg)("details",null,(0,i.yg)("summary",null," Output"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"I (11412) Task1: Hello from task 1\nI (11522) Task3: Hello from task 3\nI (11522) Task2: Hello from task 2\nI (11532) Task4: Hello from task 4\nI (12032) Task3: Hello from task 3\nI (12032) Task2: Hello from task 2\nI (12042) Task4: Hello from task 4\nI (12422) Task1: Hello from task 1\nI (12542) Task3: Hello from task 3\nI (12542) Task2: Hello from task 2\nI (12552) Task4: Hello from task 4\nI (13052) Task3: Hello from task 3\nI (13052) Task2: Hello from task 2\nI (13062) Task4: Hello from task 4\nI (13432) Task1: Hello from task 1\nI (13562) Task3: Hello from task 3\nI (13562) Task2: Hello from task 2\nI (13572) Task4: Hello from task 4\nI (14072) Task3: Hello from task 3\nI (14072) Task2: Hello from task 2\nI (14082) Task4: Hello from task 4\n"))),(0,i.yg)("h2",{id:"sensor-polling-using-freertos"},"Sensor polling using FreeRTOS"),(0,i.yg)("p",null,"For this I am using an analog sensor ",(0,i.yg)("a",{parentName:"p",href:"https://www.seeedstudio.com/Grove-Air-Quality-Sensor-v1-3-Arduino-Compatible.html"},"Air Quality Sensor v1.3")," along with ESP_IDF_v5.3."),(0,i.yg)("div",{class:"github_container",style:{textAlign:"center"}},(0,i.yg)("a",{class:"github_item",href:"https://github.com/Priyanshu0901/Air_quality_Sensor_ESP-IDF.git"},(0,i.yg)("strong",null,(0,i.yg)("span",null,(0,i.yg)("font",{color:"FFFFFF",size:"4"}," Download the Code")))," ",(0,i.yg)("svg",{"aria-hidden":"true",focusable:"false",role:"img",className:"mr-2",viewBox:"-3 10 9 1",width:16,height:16,fill:"currentColor",style:{textAlign:"center",display:"inline-block",userSelect:"none",verticalAlign:"text-bottom",overflow:"visible"}},(0,i.yg)("path",{d:"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"})))),(0,i.yg)("h3",{id:"hardware-setup"},"Hardware Setup"),(0,i.yg)("p",null,"Attach the Xiao-S3 to the ",(0,i.yg)("a",{parentName:"p",href:"https://www.seeedstudio.com/Seeeduino-XIAO-Expansion-board-p-4746.html"},"Grove - Expansion Board")," and connect the ",(0,i.yg)("a",{parentName:"p",href:"https://www.seeedstudio.com/Grove-Air-Quality-Sensor-v1-3-Arduino-Compatible.html"},"Air Quality Sensor v1.3")," to the analog connector."),(0,i.yg)("p",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/3.jpg",alt:"pir",width:600,height:"auto"})),(0,i.yg)("h3",{id:"software-setup"},"Software Setup"),(0,i.yg)("p",null,"After pulling the git repository, open the folder in VSCode. Go to View->Command Palette->ESP-IDF: Add vscode Configuration Folder.\nFrom the bottom panel select the correct COM port, chip (ESP-S3) and build,flash and monitor."),(0,i.yg)("h3",{id:"code-overview"},"Code Overview"),(0,i.yg)("p",null,"This code is designed to collect air quality data from a sensor, process the raw data to determine the air quality level, and periodically print the results to the console."),(0,i.yg)("h4",{id:"key-components"},"Key Components:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Sensor Initialization:")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},'air_quality_sensor_t air_quality_sensor;\n\nvoid sensor_setup()\n{\n    air_quality_sensor._io_num = ADC_CHANNEL_0;\n    air_quality_sensor._adc_num = ADC_UNIT_1;\n    printf("Starting Air Quality Sensor...\\n");\n    if(!initialize_air_quality_sensor(&air_quality_sensor))\n    {\n        printf("Sensor ready.\\n");\n    }\n    else{\n        printf("Sensor ERROR!\\n");\n    }\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"sensor_setup() function configures the sensor's I/O pins and ADC unit.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"It attempts to initialize the sensor using initialize_air_quality_sensor().")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"If initialization is successful, the sensor is ready for data collection.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Data Collection Task:"))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},"void poll_read_air_quality_sensor(void *pvParameters)\n{\n    for (;;)\n    {\n        air_quality_sensor_slope(&air_quality_sensor);\n        vTaskDelay(500 / portTICK_PERIOD_MS);\n    }\n}\n")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"poll_read_air_quality_sensor() task is created to continuously read raw data from the sensor.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"It calls air_quality_sensor_slope() to process the raw data and calculate the slope, which is an indicator of air quality.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"The task delays for 500 milliseconds before reading the next data point.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Data Printing Task:"))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},'\nvoid print_read_air_quality_sensor(void *pvParameters)\n{\n    for (;;)\n    {\n        char buf[40];\n        air_quality_error_to_message(air_quality_sensor._air_quality,buf);\n        printf("Time : %lu\\tSlope : %d\\tRaw Value : %d\\n%s\\n", (uint32_t)esp_timer_get_time() / 1000, air_quality_sensor._air_quality, air_quality_sensor._sensor_raw_value,buf);\n        vTaskDelay(1000 / portTICK_PERIOD_MS);\n    }\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"print_read_air_quality_sensor() task is created to periodically print the collected data and calculated air quality."),(0,i.yg)("li",{parentName:"ul"},"It retrieves the current time, slope, raw value, and air quality message using air_quality_error_to_message()."),(0,i.yg)("li",{parentName:"ul"},"The task prints the data to the console in a formatted manner."),(0,i.yg)("li",{parentName:"ul"},"The task delays for 1000 milliseconds before printing the next data point.")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},'\nvoid app_main(void)\n{\n    sensor_setup();\n    xTaskCreatePinnedToCore(\n        poll_read_air_quality_sensor,   /* Function that implements the task. */\n        "poll_read_air_quality_sensor", /* Text name for the task. */\n        configMINIMAL_STACK_SIZE * 2,   /* Stack size in words, not bytes. */\n        NULL,                           /* Parameter passed into the task. */\n        tskIDLE_PRIORITY,               /* Priority at which the task is created. */\n        NULL,                           /* Used to pass out the created task\'s handle. */\n        0);                             /* Core ID */\n\n    xTaskCreatePinnedToCore(\n        print_read_air_quality_sensor,   /* Function that implements the task. */\n        "print_read_air_quality_sensor", /* Text name for the task. */\n        configMINIMAL_STACK_SIZE * 2,    /* Stack size in words, not bytes. */\n        NULL,                            /* Parameter passed into the task. */\n        tskIDLE_PRIORITY + 1,            /* Priority at which the task is created. */\n        NULL,                            /* Used to pass out the created task\'s handle. */\n        0);                              /* Core ID */\n}\n')),(0,i.yg)("h3",{id:"output"},"Output"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"Time : 37207    Slope : 3       Raw Value : 273\nFresh air.\nTime : 38217    Slope : 3       Raw Value : 269\nFresh air.\nTime : 39227    Slope : 3       Raw Value : 274\nFresh air.\nTime : 40237    Slope : 3       Raw Value : 251\nFresh air.\nTime : 41247    Slope : 3       Raw Value : 276\nFresh air.\nTime : 42257    Slope : 3       Raw Value : 250\nFresh air.\nTime : 43267    Slope : 3       Raw Value : 236\nFresh air.\nTime : 44277    Slope : 3       Raw Value : 253\nFresh air.\nTime : 45287    Slope : 3       Raw Value : 245\nFresh air.\nTime : 46297    Slope : 3       Raw Value : 249\nFresh air.\nTime : 47307    Slope : 3       Raw Value : 244\nFresh air.\nTime : 48317    Slope : 3       Raw Value : 235\nFresh air.\nTime : 49327    Slope : 3       Raw Value : 239\nFresh air.\nTime : 50337    Slope : 3       Raw Value : 233\nFresh air.\nTime : 51347    Slope : 3       Raw Value : 235\nFresh air.\n")),(0,i.yg)("h2",{id:"camera-and-sdcard-usage-in-freertos"},"Camera and SdCard usage in FreeRTOS"),(0,i.yg)("p",null,"For this I am using the onBoard Camera and SdCard along with ESP_IDF_v5.3."),(0,i.yg)("div",{class:"github_container",style:{textAlign:"center"}},(0,i.yg)("a",{class:"github_item",href:"https://github.com/Priyanshu0901/Camera-and-SdCard-FreeRTOS.git"},(0,i.yg)("strong",null,(0,i.yg)("span",null,(0,i.yg)("font",{color:"FFFFFF",size:"4"}," Download the Code")))," ",(0,i.yg)("svg",{"aria-hidden":"true",focusable:"false",role:"img",className:"mr-2",viewBox:"-3 10 9 1",width:16,height:16,fill:"currentColor",style:{textAlign:"center",display:"inline-block",userSelect:"none",verticalAlign:"text-bottom",overflow:"visible"}},(0,i.yg)("path",{d:"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"})))),(0,i.yg)("h3",{id:"hardware-setup-1"},"Hardware Setup"),(0,i.yg)("p",null,"Follow the ",(0,i.yg)("a",{parentName:"p",href:"https://wiki.seeedstudio.com/xiao_esp32s3_sense_filesystem/"},"microSD card guide")," and ",(0,i.yg)("a",{parentName:"p",href:"https://wiki.seeedstudio.com/xiao_esp32s3_camera_usage/"},"camera guide")," to attach the camera and microSD card extension board to the"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Format microSD card (supported up to 32Gb)"),(0,i.yg)("li",{parentName:"ul"},"Attach the microSD card to the extension board")),(0,i.yg)("p",null,"The setup would look something like this :"),(0,i.yg)("div",{class:"table-center"},(0,i.yg)("table",{align:"center"},(0,i.yg)("tr",null,(0,i.yg)("th",null,"Front"),(0,i.yg)("th",null,"Back")),(0,i.yg)("tr",null,(0,i.yg)("td",null,(0,i.yg)("div",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/6.jpeg",style:{width:250,height:"auto"}}))),(0,i.yg)("td",null,(0,i.yg)("div",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/7.jpeg",style:{width:250,height:"auto"}})))))),(0,i.yg)("h3",{id:"software-setup-1"},"Software Setup"),(0,i.yg)("p",null,"After pulling the git repository, open the folder in VSCode. Go to View->Command Palette->ESP-IDF: Add vscode Configuration Folder.\nFrom the bottom panel select the correct COM port, chip (ESP-S3) and build,flash and monitor."),(0,i.yg)("h3",{id:"camera-component"},"Camera Component"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Camera Configuration:",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Defines the GPIO pins used for various camera functions (PWDN, RESET, XCLK, SIOD, SIOC, Y9-Y2, VSYNC, HREF, PCLK, LED)."),(0,i.yg)("li",{parentName:"ul"},"Sets default values for camera parameters (e.g., clock frequency, frame buffer location, pixel format, frame size, JPEG quality, frame buffer count, grab mode).")))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},"#ifndef CAMERA_CONFIG_H\n#define CAMERA_CONFIG_H\n\n#define PWDN_GPIO_NUM     -1\n#define RESET_GPIO_NUM    -1\n#define XCLK_GPIO_NUM     10\n#define SIOD_GPIO_NUM     40\n#define SIOC_GPIO_NUM     39\n\n#define Y9_GPIO_NUM       48\n#define Y8_GPIO_NUM       11\n#define Y7_GPIO_NUM       12\n#define Y6_GPIO_NUM       14\n#define Y5_GPIO_NUM       16\n#define Y4_GPIO_NUM       18\n#define Y3_GPIO_NUM       17\n#define Y2_GPIO_NUM       15\n#define VSYNC_GPIO_NUM    38\n#define HREF_GPIO_NUM     47\n#define PCLK_GPIO_NUM     13\n\n#define LED_GPIO_NUM      21\n\n#endif //CAMERA_CONFIG_H\n")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Camera Interface:",(0,i.yg)("br",{parentName:"p"}),"\n","Declares functions initialize_camera() and createCameraTask().")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Camera Implementation:"),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Initializes the camera using the defined configuration.")),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-c"},'void initialize_camera(void)\n{\n  camera_config_t camera_config = {\n      .pin_pwdn = PWDN_GPIO_NUM,\n      .pin_reset = RESET_GPIO_NUM,\n      .pin_xclk = XCLK_GPIO_NUM,\n      .pin_sccb_sda = SIOD_GPIO_NUM,\n      .pin_sccb_scl = SIOC_GPIO_NUM,\n      .pin_d7 = Y9_GPIO_NUM,\n      .pin_d6 = Y8_GPIO_NUM,\n      .pin_d5 = Y7_GPIO_NUM,\n      .pin_d4 = Y6_GPIO_NUM,\n      .pin_d3 = Y5_GPIO_NUM,\n      .pin_d2 = Y4_GPIO_NUM,\n      .pin_d1 = Y3_GPIO_NUM,\n      .pin_d0 = Y2_GPIO_NUM,\n      .pin_vsync = VSYNC_GPIO_NUM,\n      .pin_href = HREF_GPIO_NUM,\n      .pin_pclk = PCLK_GPIO_NUM,\n\n      .xclk_freq_hz = 20000000,          // The clock frequency of the image sensor\n      .fb_location = CAMERA_FB_IN_PSRAM, // Set the frame buffer storage location\n      .pixel_format = PIXFORMAT_JPEG,    // The pixel format of the image: PIXFORMAT_ + YUV422|GRAYSCALE|RGB565|JPEG\n      .frame_size = FRAMESIZE_UXGA,      // The resolution size of the image: FRAMESIZE_ + QVGA|CIF|VGA|SVGA|XGA|SXGA|UXGA\n      .jpeg_quality = 15,                // The quality of the JPEG image, ranging from 0 to 63.\n      .fb_count = 2,                     // The number of frame buffers to use.\n      .grab_mode = CAMERA_GRAB_LATEST    //  The image capture mode.\n  };\n\n  esp_err_t ret = esp_camera_init(&camera_config);\n  if (ret == ESP_OK)\n  {\n      ESP_LOGI(cameraTag, "Camera configured successful");\n  }\n  else\n  {\n      ESP_LOGI(cameraTag, "Camera configured unsuccessful");\n      return;\n  }\n}\n')),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Sets camera parameters (brightness, contrast, saturation, special effect, white balance, exposure control, AEC, AE level, AEC value, gain control, AGC gain, gain ceiling, BPC, WPC, raw GMA, LENC, hmirror, vflip, DCW, colorbar).")),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-c"},"sensor_t *s = esp_camera_sensor_get();\n\n  s->set_brightness(s, 0);                 // -2 to 2\n  s->set_contrast(s, 0);                   // -2 to 2\n  s->set_saturation(s, 0);                 // -2 to 2\n  s->set_special_effect(s, 0);             // 0 to 6 (0 - No Effect, 1 - Negative, 2 - Grayscale, 3 - Red Tint, 4 - Green Tint, 5 - Blue Tint, 6 - Sepia)\n  s->set_whitebal(s, 1);                   // 0 = disable , 1 = enable\n  s->set_awb_gain(s, 1);                   // 0 = disable , 1 = enable\n  s->set_wb_mode(s, 0);                    // 0 to 4 - if awb_gain enabled (0 - Auto, 1 - Sunny, 2 - Cloudy, 3 - Office, 4 - Home)\n  s->set_exposure_ctrl(s, 1);              // 0 = disable , 1 = enable\n  s->set_aec2(s, 0);                       // 0 = disable , 1 = enable\n  s->set_ae_level(s, 0);                   // -2 to 2\n  s->set_aec_value(s, 300);                // 0 to 1200\n  s->set_gain_ctrl(s, 1);                  // 0 = disable , 1 = enable\n  s->set_agc_gain(s, 0);                   // 0 to 30\n  s->set_gainceiling(s, (gainceiling_t)0); // 0 to 6\n  s->set_bpc(s, 0);                        // 0 = disable , 1 = enable\n  s->set_wpc(s, 1);                        // 0 = disable , 1 = enable\n  s->set_raw_gma(s, 1);                    // 0 = disable , 1 = enable\n  s->set_lenc(s, 1);                       // 0 = disable , 1 = enable\n  s->set_hmirror(s, 0);                    // 0 = disable , 1 = enable\n  s->set_vflip(s, 0);                      // 0 = disable , 1 = enable\n  s->set_dcw(s, 1);                        // 0 = disable , 1 = enable\n  s->set_colorbar(s, 0);                   // 0 = disable , 1 = enable\n")),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Defines a function takePicture() to capture an image and save it to SD card.")),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-c"},'void takePicture()\n{\n  ESP_LOGI(cameraTag, "Taking picture...");\n  camera_fb_t *pic = esp_camera_fb_get();\n\n  if (pic)\n  {\n      saveJpegToSdcard(pic);\n  }\n\n  ESP_LOGI(cameraTag, "Picture taken! Its size was: %zu bytes", pic->len);\n\n  esp_camera_fb_return(pic);\n}\n')),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Creates a task cameraTakePicture_5_sec() to continuously take pictures every 5 seconds.")),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-c"},'void cameraTakePicture_5_sec(void *pvParameters)\n{\n    for (;;)\n    {\n        takePicture();\n        vTaskDelay(5000 / portTICK_PERIOD_MS);\n    }\n}\n\nvoid createCameraTask()\n{\n    TaskHandle_t task;\n    xTaskCreate(\n        cameraTakePicture_5_sec,      /* Function that implements the task. */\n        "cameraTakePicture_5_sec",    /* Text name for the task. */\n        configMINIMAL_STACK_SIZE * 4, /* Stack size in words, or bytes. */\n        NULL,                         /* Parameter passed into the task. */\n        tskIDLE_PRIORITY,             /* Priority at which the task is created. */\n        &task                         /* Used to pass out the created task\'s handle. */\n    );\n}\n')))),(0,i.yg)("p",null,"Code Structure:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Header files (camera_config.h, camera_interface.h) and implementation files (camera_interface.c)."),(0,i.yg)("li",{parentName:"ul"},"The camera_config.h file defines the camera configuration parameters."),(0,i.yg)("li",{parentName:"ul"},"The camera_interface.h file declares the functions for camera initialization and task creation."),(0,i.yg)("li",{parentName:"ul"},"The camera_interface.c file implements the camera initialization, picture-taking, and task creation logic.")),(0,i.yg)("h3",{id:"sdcard-component"},"SdCard Component"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"SD Card Configuration:",(0,i.yg)("br",{parentName:"li"}),"Defines the GPIO pins used for the SD card interface (MISO, MOSI, CLK, CS).")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},"#ifndef SDCARD_CONFIG_H\n#define SDCARD_CONFIG_H\n\n#define PIN_NUM_MISO  GPIO_NUM_8\n#define PIN_NUM_MOSI  GPIO_NUM_9\n#define PIN_NUM_CLK   GPIO_NUM_7\n#define PIN_NUM_CS    GPIO_NUM_21\n\n#endif //SDCARD_CONFIG_H\n")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"SD Card Interface:",(0,i.yg)("br",{parentName:"li"}),"Declares functions initialize_sdcard(), deinitialize_sdcard(), and saveJpegToSdcard().")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},'#ifndef SDCARD_INTERFACE_H\n#define SDCARD_INTERFACE_H\n\n#include "esp_camera.h"\n\nvoid initialize_sdcard(void);\nvoid deinitialize_sdcard();\nvoid saveJpegToSdcard(camera_fb_t *);\n\n#endif //SDCARD_INTERFACE_H\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"SD Card Implementation:"),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Initializes the SD card using the defined configuration and mounts the SD card as a FAT filesystem.")),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-c"},'sdmmc_card_t *card;\nsdmmc_host_t host = SDSPI_HOST_DEFAULT();\nconst char mount_point[] = "/sd";\n\nvoid initialize_sdcard()\n{\n    esp_err_t ret;\n\n    // If format_if_mount_failed is set to true, SD card will be partitioned and\n    // formatted in case when mounting fails.\n    esp_vfs_fat_sdmmc_mount_config_t mount_config = {\n#ifdef FORMAT_IF_MOUNT_FAILED\n        .format_if_mount_failed = true,\n#else\n        .format_if_mount_failed = false,\n#endif // EXAMPLE_FORMAT_IF_MOUNT_FAILED\n        .max_files = 5,\n        .allocation_unit_size = 32 * 1024};\n\n    ESP_LOGI(sdcardTag, "Initializing SD card");\n\n    // Use settings defined above to initialize SD card and mount FAT filesystem.\n    // Note: esp_vfs_fat_sdmmc/sdspi_mount is all-in-one convenience functions.\n    // Please check its source code and implement error recovery when developing\n    // production applications.\n    ESP_LOGI(sdcardTag, "Using SPI peripheral");\n\n    // By default, SD card frequency is initialized to SDMMC_FREQ_DEFAULT (20MHz)\n    // For setting a specific frequency, use host.max_freq_khz (range 400kHz - 20MHz for SDSPI)\n    spi_bus_config_t bus_cfg = {\n        .mosi_io_num = PIN_NUM_MOSI,\n        .miso_io_num = PIN_NUM_MISO,\n        .sclk_io_num = PIN_NUM_CLK,\n        .quadwp_io_num = -1,\n        .quadhd_io_num = -1,\n        .max_transfer_sz = host.max_freq_khz,\n    };\n    ret = spi_bus_initialize(host.slot, &bus_cfg, SDSPI_DEFAULT_DMA);\n    if (ret != ESP_OK)\n    {\n        ESP_LOGE(sdcardTag, "Failed to initialize bus.");\n        return;\n    }\n\n    // This initializes the slot without card detect (CD) and write protect (WP) signals.\n    // Modify slot_config.gpio_cd and slot_config.gpio_wp if your board has these signals.\n    sdspi_device_config_t slot_config = SDSPI_DEVICE_CONFIG_DEFAULT();\n    slot_config.gpio_cs = PIN_NUM_CS;\n    slot_config.host_id = host.slot;\n\n    ESP_LOGI(sdcardTag, "Mounting filesystem");\n    ret = esp_vfs_fat_sdspi_mount(mount_point, &host, &slot_config, &mount_config, &card);\n\n    if (ret != ESP_OK)\n    {\n        if (ret == ESP_FAIL)\n        {\n            ESP_LOGE(sdcardTag, "Failed to mount filesystem. "\n                                "If you want the card to be formatted, set the FORMAT_IF_MOUNT_FAILED in sdcard_config.h");\n        }\n        else\n        {\n            ESP_LOGE(sdcardTag, "Failed to initialize the card (%s). "\n                                "Make sure SD card lines have pull-up resistors in place.",\n                    esp_err_to_name(ret));\n        }\n        return;\n    }\n    ESP_LOGI(sdcardTag, "Filesystem mounted");\n\n    // Card has been initialized, print its properties\n    sdmmc_card_print_info(stdout, card);\n\n    // Format FATFS\n#ifdef FORMAT_SD_CARD\n    ret = esp_vfs_fat_sdcard_format(mount_point, card);\n    if (ret != ESP_OK)\n    {\n        ESP_LOGE(sdcardTag, "Failed to format FATFS (%s)", esp_err_to_name(ret));\n        return;\n    }\n\n    if (stat(file_foo, &st) == 0)\n    {\n        ESP_LOGI(sdcardTag, "file still exists");\n        return;\n    }\n    else\n    {\n        ESP_LOGI(sdcardTag, "file doesnt exist, format done");\n    }\n#endif // CONFIG_EXAMPLE_FORMAT_SD_CARD\n}\n')),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Provides functions to save JPEG images to the SD card.")),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-c"},'uint16_t lastKnownFile = 0;\n\nvoid saveJpegToSdcard(camera_fb_t *captureImage)\n{\n  // Find the next available filename\n  char filename[32];\n\n  sprintf(filename, "%s/%u_img.jpg", mount_point, lastKnownFile++);\n\n  // Create the file and write the JPEG data\n  FILE *fp = fopen(filename, "wb");\n  if (fp != NULL)\n  {\n      fwrite(captureImage->buf, 1, captureImage->len, fp);\n      fclose(fp);\n      ESP_LOGI(sdcardTag, "JPEG saved as %s", filename);\n  }\n  else\n  {\n      ESP_LOGE(sdcardTag, "Failed to create file: %s", filename);\n  }\n}\n')))),(0,i.yg)("p",null,"Component Structure:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Header files (sdcard_config.h, sdcard_interface.h) and implementation files (sdcard_interface.c)."),(0,i.yg)("li",{parentName:"ul"},"The sdcard_config.h file defines the SD card configuration parameters."),(0,i.yg)("li",{parentName:"ul"},"The sdcard_interface.h file declares the functions for SD card initialization, deinitialization, and image saving."),(0,i.yg)("li",{parentName:"ul"},"The sdcard_interface.c file implements the SD card initialization, deinitialization, and image saving logic.")),(0,i.yg)("h3",{id:"main-function"},"Main Function"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-c"},'// main.c\n#include <stdio.h>\n#include "camera_interface.h"\n#include "sdcard_interface.h"\n\nvoid initialize_drivers()\n{\n    initialize_sdcard();\n    initialize_camera();\n}\n\nvoid start_tasks()\n{\n    createCameraTask();\n}\n\nvoid app_main(void)\n{\n    initialize_drivers();\n    start_tasks();\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Includes necessary header files for camera and SD card interfaces."),(0,i.yg)("li",{parentName:"ul"},"Initializes both the SD card and camera using the provided functions."),(0,i.yg)("li",{parentName:"ul"},"Starts the camera task to continuously take pictures")),(0,i.yg)("h3",{id:"output-1"},"Output"),(0,i.yg)("p",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/8.gif",alt:"pir",width:600,height:"auto"})),(0,i.yg)("h4",{id:"uart-output"},"UART Output"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"I (1119) main_task: Calling app_main()\nI (1123) sdcard: Initializing SD card\nI (1127) sdcard: Using SPI peripheral\nI (1132) sdcard: Mounting filesystem\nI (1137) gpio: GPIO[21]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0\nI (1146) sdspi_transaction: cmd=52, R1 response: command not supported\nI (1195) sdspi_transaction: cmd=5, R1 response: command not supported\nI (1219) sdcard: Filesystem mounted\nName: SD32G\nType: SDHC/SDXC\nSpeed: 20.00 MHz (limit: 20.00 MHz)\nSize: 30448MB\nCSD: ver=2, sector_size=512, capacity=62357504 read_bl_len=9\nSSR: bus_width=1\nI (1226) s3 ll_cam: DMA Channel=1\nI (1230) cam_hal: cam init ok\nI (1234) sccb: pin_sda 40 pin_scl 39\nI (1238) sccb: sccb_i2c_port=1\nI (1252) camera: Detected camera at address=0x30\nI (1255) camera: Detected OV2640 camera\nI (1255) camera: Camera PID=0x26 VER=0x42 MIDL=0x7f MIDH=0xa2\nI (1344) cam_hal: buffer_size: 16384, half_buffer_size: 1024, node_buffer_size: 1024, node_cnt: 16, total_cnt: 375\nI (1344) cam_hal: Allocating 384000 Byte frame buffer in PSRAM\nI (1351) cam_hal: Allocating 384000 Byte frame buffer in PSRAM\nI (1357) cam_hal: cam config ok\nI (1361) ov2640: Set PLL: clk_2x: 0, clk_div: 0, pclk_auto: 0, pclk_div: 12\nI (1453) camera: Camera configured successful\nI (1487) main_task: Returned from app_main()\nI (1487) camera: Taking picture...\nI (1997) sdcard: JPEG saved as /sd/0_img.jpg\nI (1997) camera: Picture taken! Its size was: 45764 bytes\nI (6997) camera: Taking picture...\nI (7348) sdcard: JPEG saved as /sd/1_img.jpg\nI (7349) camera: Picture taken! Its size was: 51710 bytes\nI (12349) camera: Taking picture...\nI (12704) sdcard: JPEG saved as /sd/2_img.jpg\nI (12705) camera: Picture taken! Its size was: 51853 bytes\nI (17706) camera: Taking picture...\nI (18054) sdcard: JPEG saved as /sd/3_img.jpg\nI (18055) camera: Picture taken! Its size was: 51919 bytes\nI (23055) camera: Taking picture...\nI (23414) sdcard: JPEG saved as /sd/4_img.jpg\nI (23414) camera: Picture taken! Its size was: 51809 bytes\nI (28415) camera: Taking picture...\nI (28768) sdcard: JPEG saved as /sd/5_img.jpg\nI (28768) camera: Picture taken! Its size was: 51747 bytes\nI (33771) camera: Taking picture...\nI (34117) sdcard: JPEG saved as /sd/6_img.jpg\nI (34117) camera: Picture taken! Its size was: 51968 bytes\n")),(0,i.yg)("h4",{id:"output-image"},"Output Image"),(0,i.yg)("p",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/9.jpg",alt:"pir",width:600,height:"auto"})),(0,i.yg)("h2",{id:"freertos-for-arduino-ide"},"FreeRtos for Arduino IDE"),(0,i.yg)("p",null,"FreeRtos can be used for Arduino-IDE based XIAO-S3 builds. It is similar to ESP-IDF usable but it runs on only one core and is not optimized for ESP-IDF."),(0,i.yg)("h3",{id:"hardware-setup-2"},"Hardware Setup"),(0,i.yg)("p",null,"Attach the Xiao-S3 to the ",(0,i.yg)("a",{parentName:"p",href:"https://www.seeedstudio.com/Seeeduino-XIAO-Expansion-board-p-4746.html"},"Grove - Expansion Board")," (OLED DIsplay and RTC) and connect the ",(0,i.yg)("a",{parentName:"p",href:"https://www.seeedstudio.com/Grove-Temperature-Humidity-Pressure-and-Gas-Sensor-for-Arduino-BME680.html"},"Grove - Temperature, Humidity, Pressure and Gas Sensor for Arduino - BME680")," to the I2c Bus."),(0,i.yg)("p",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/4.jpg",alt:"pir",width:600,height:"auto"})),(0,i.yg)("h3",{id:"software-setup-2"},"Software Setup"),(0,i.yg)("p",null,"Install the arduino libraries for ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/Bill2462/PCF8563-Arduino-Library"},"pcf8563"),", ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/olikraus/U8g2_Arduino"},"U8x8lib")," and ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/Seeed-Studio/Seeed_Arduino_BME68x"},"bme680")," library. Refer to ",(0,i.yg)("a",{parentName:"p",href:"https://wiki.seeedstudio.com/How_to_install_Arduino_Library/"},"How to install library")," to install library for Arduino."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "time.h"\n#include <WiFi.h>\n#include <PCF8563.h>\n#include <U8x8lib.h>\n#include <Wire.h>\n#include "seeed_bme680.h"\n\n#define IIC_ADDR uint8_t(0x76)\nSeeed_BME680 bme680(IIC_ADDR); /* IIC PROTOCOL */\n\n// I2C communication library for the PCF8563 real-time clock\nPCF8563 pcf;\n\n// OLED display library\nU8X8_SSD1306_128X64_NONAME_HW_I2C u8x8(/* clock=*/D4, /* data=*/D5, /* reset=*/U8X8_PIN_NONE);  // OLEDs without Reset of the Display\n\n// WiFi network credentials\nconst char* ssid = "REPLACE_WITH_YOUR_SSID";\nconst char* password = "REPLACE_WITH_YOUR_PASSWORD";\n\n// NTP server for time synchronization\nconst char* ntpServer = "pool.ntp.org";\n\n// Timezone offset (adjust based on your location)\nconst long gmtOffset_sec = 5.5 * 60 * 60;  // Hours * Minutes * Seconds (here, GMT+5:30)\nconst int daylightOffset_sec = 0;          // No daylight saving time assumed\n\n// Global variable to store current time information\nstatic Time nowTime;\n\n// Function prototypes for tasks\nvoid printDateAndTime(void* pvParameters);\nvoid updateTime(void* pvParameters);\nvoid ledBlink2Hz(void* pvParameters);\nvoid oledDisplayUpdate(void* pvParameters);\nvoid taskBME680(void* pvParameters);\n\n// Setup function (runs once at startup)\nvoid setup() {\n\n  Serial.begin(115200);  // Initialize serial communication for debugging\n\n  // Set built-in LED pin as output for blinking\n  pinMode(LED_BUILTIN, OUTPUT);\n\n  Serial.print("Connecting to ");\n  Serial.println(ssid);\n  WiFi.begin(ssid, password);  // Connect to WiFi network\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(500);\n    Serial.print(".");\n  }\n\n  while (!bme680.init()) {\n    Serial.println("bme680 init failed ! can\'t find device!");\n    delay(10000);\n  }\n\n  pcf.init();  // Initialize the PCF8563 real-time clock\n\n  // Stop the clock before setting the time\n  pcf.stopClock();\n\n  // Configure time synchronization using NTP server\n  configTime(gmtOffset_sec, daylightOffset_sec, ntpServer);\n  static struct tm timeinfo;\n  while (!getLocalTime(&timeinfo)) {\n    Serial.println("no received time info ... Waiting ...");\n  }\n\n  // Set the time on the PCF8563 clock based on retrieved time\n  pcf.setYear(timeinfo.tm_year);\n  pcf.setMonth(timeinfo.tm_mon);\n  pcf.setDay(timeinfo.tm_mday);\n  pcf.setHour(timeinfo.tm_hour);\n  pcf.setMinut(timeinfo.tm_min);\n  pcf.setSecond(timeinfo.tm_sec);\n\n  pcf.startClock();  // Start the clock after setting the time\n\n  Serial.println("WiFi connected at " + WiFi.localIP());\n\n  u8x8.begin();         // Initialize the OLED display\n  u8x8.setFlipMode(1);  // Optionally rotate OLED display content\n\n  // Create tasks for different functionalities\n  xTaskCreate(\n    updateTime,\n    "Get LocalTime",\n    configMINIMAL_STACK_SIZE * 2,\n    (void*)1,\n    tskIDLE_PRIORITY + 1,\n    NULL);\n\n  xTaskCreate(\n    ledBlink2Hz,\n    "Task 2",\n    configMINIMAL_STACK_SIZE,\n    (void*)1,\n    tskIDLE_PRIORITY + 1,\n    NULL);\n\n  xTaskCreate(\n    oledDisplayUpdate,\n    "OLED Display Task",\n    configMINIMAL_STACK_SIZE * 2,\n    (void*)1,\n    tskIDLE_PRIORITY,\n    NULL);\n\n  xTaskCreate(\n    printDateAndTime,\n    "Print Uart",\n    configMINIMAL_STACK_SIZE * 2,\n    (void*)1,\n    tskIDLE_PRIORITY,\n    NULL);\n\n  xTaskCreate(\n    taskBME680,\n    "BME680 Sensor Poll",\n    configMINIMAL_STACK_SIZE * 2,\n    (void*)1,\n    tskIDLE_PRIORITY + 1,\n    NULL);\n}\n\n// Loop function (doesn\'t do anything in this case, tasks handle everything)\nvoid loop() {\n  // Nothing to do here, all work is done in the tasks\n}\n\n// Function that will run as a task: Prints current date and time to serial port\nvoid printDateAndTime(void* pvParameters) {\n  for (;;) {\n    // Print current time in formatted string (DD/MM/YY\\tHH:MM:SS) to serial port\n    Serial.printf("%02d/%02d/%02d\\t%02d:%02d:%02d\\n",\n                  nowTime.day, nowTime.month + 1, nowTime.year % 100,\n                  nowTime.hour, nowTime.minute, nowTime.second);\n    // Delay for 1 second before reading time again\n    vTaskDelay(1000 / portTICK_PERIOD_MS);\n  }\n}\n\n// Function that will run as a task: Reads current time from PCF8563 clock\nvoid updateTime(void* pvParameters) {\n  for (;;) {\n    // Update the global `nowTime` variable with the current time from the PCF8563 clock\n    nowTime = pcf.getTime();\n    // Delay for 0.5 second before reading time again (can be adjusted for desired update frequency)\n    vTaskDelay(500 / portTICK_PERIOD_MS);\n  }\n}\n\n// Function that will run as a task: Blinks the built-in LED at 2Hz\nvoid ledBlink2Hz(void* pvParameters) {\n  bool state = true;  // Initial state for LED (on or off)\n  for (;;) {\n    // Set LED state (HIGH for on, LOW for off)\n    digitalWrite(LED_BUILTIN, (state ? HIGH : LOW));\n    // Delay for 0.5 second to create a 2Hz blinking frequency (one cycle on/off)\n    vTaskDelay(500 / portTICK_PERIOD_MS);\n    // Toggle LED state for the next cycle\n    state = !state;\n  }\n}\n\n// Function that will run as a task: Updates OLED display with date and time\nvoid oledDisplayUpdate(void* pvParameters) {\n  for (;;) {\n\n    // Set font for the first line (date)\n    u8x8.setFont(u8x8_font_chroma48medium8_r);\n\n    // Set cursor position for the first line (centered)\n    u8x8.setCursor(0, 0);\n\n    char buffer1[12];  // Buffer to hold formatted date string\n    std::snprintf(buffer1, sizeof(buffer1), "%02d/%02d/%02d",\n                  nowTime.day, nowTime.month + 1, nowTime.year % 100);\n    u8x8.print(buffer1);\n\n    // Format time string (HH:MM:SS) into buffer2 using std::snprintf\n    std::snprintf(buffer1, sizeof(buffer1), "%02d:%02d:%02d",\n                  nowTime.hour, nowTime.minute, nowTime.second);\n    // Print formatted time string to OLED display\n    u8x8.print(buffer1);\n\n    // Adjust cursor position for the second line (below the first line)\n    u8x8.setCursor(0, 10);\n\n    char buffer2[20];  // Buffer to hold formatted sensor data\n\n    std::snprintf(buffer2, sizeof(buffer2), "T: %.1f\xb0C", bme680.sensor_result_value.temperature);\n    u8x8.print(buffer2);\n    u8x8.setCursor(0, 20);\n\n    std::snprintf(buffer2, sizeof(buffer2), "P: %.1fkPa", bme680.sensor_result_value.pressure / 1000.0);\n    u8x8.print(buffer2);\n\n    u8x8.setCursor(0, 30);\n\n    std::snprintf(buffer2, sizeof(buffer2), "H: %.1f%%", bme680.sensor_result_value.humidity);\n    u8x8.print(buffer2);\n\n    // std::snprintf(buffer2, sizeof(buffer2), "G: %.1f Kohms", bme680.sensor_result_value.gas / 1000.0);\n    // u8x8.print(buffer2);\n\n    vTaskDelay(100 / portTICK_PERIOD_MS);  // Update every 0.1 seconds (adjust as needed)\n  }\n}\n\nvoid taskBME680(void* pvParameters) {\n  for (;;) {\n    if (bme680.read_sensor_data()) {\n      Serial.println("Failed to perform reading :(");\n    } else {\n      Serial.print("T: ");\n      Serial.print(bme680.sensor_result_value.temperature, 2);\n      Serial.print(" C  P: ");\n      Serial.print(bme680.sensor_result_value.pressure / 1000.0, 2);\n      Serial.print(" KPa  H: ");\n      Serial.print(bme680.sensor_result_value.humidity, 2);\n      Serial.print(" %  G: ");\n      Serial.print(bme680.sensor_result_value.gas / 1000.0, 2);\n      Serial.println(" Kohms");\n    }\n\n    vTaskDelay(1000 / portTICK_PERIOD_MS);\n  }\n}\n')),(0,i.yg)("h3",{id:"output-2"},"Output"),(0,i.yg)("p",{style:{textAlign:"center"}},(0,i.yg)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp32s3_freertos/5.gif",alt:"pir",width:600,height:"auto"})),(0,i.yg)("h3",{id:"serial-monitor-output"},"Serial Monitor Output"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"09/09/24    03:17:20\nT: 29.01 C  P: 90.86 KPa  H: 63.41 %  G: 47.41 Kohms\n09/09/24    03:17:21\nT: 29.03 C  P: 90.86 KPa  H: 63.34 %  G: 47.85 Kohms\n")),(0,i.yg)("h2",{id:"arduino-freertos-vs-esp-idf-freertos"},"Arduino FreeRtos vs ESP-IDF FreeRtos"),(0,i.yg)("table",null,(0,i.yg)("thead",{parentName:"table"},(0,i.yg)("tr",{parentName:"thead"},(0,i.yg)("th",{parentName:"tr",align:null},"Feature"),(0,i.yg)("th",{parentName:"tr",align:null},"Arduino FreeRTOS"),(0,i.yg)("th",{parentName:"tr",align:null},"ESP-IDF FreeRTOS"))),(0,i.yg)("tbody",{parentName:"table"},(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"Abstraction Layer"),(0,i.yg)("td",{parentName:"tr",align:null},"Higher-level abstraction, easier for beginners"),(0,i.yg)("td",{parentName:"tr",align:null},"Lower-level abstraction, more control for experienced users")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"Development Environment"),(0,i.yg)("td",{parentName:"tr",align:null},"Arduino IDE"),(0,i.yg)("td",{parentName:"tr",align:null},"ESP-IDF command-line tools")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"Compatibility"),(0,i.yg)("td",{parentName:"tr",align:null},"Primarily compatible with Arduino-based boards"),(0,i.yg)("td",{parentName:"tr",align:null},"Compatible with a wider range of ESP32 and ESP32-S2 boards")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"Features"),(0,i.yg)("td",{parentName:"tr",align:null},"Basic RTOS features, task creation, scheduling, synchronization"),(0,i.yg)("td",{parentName:"tr",align:null},"Comprehensive RTOS features, task creation, scheduling, synchronization, event groups, queues, mutexes, semaphores")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"Performance"),(0,i.yg)("td",{parentName:"tr",align:null},"Generally less performant due to the abstraction layer"),(0,i.yg)("td",{parentName:"tr",align:null},"More performant due to direct access to hardware and RTOS APIs")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"Customization"),(0,i.yg)("td",{parentName:"tr",align:null},"Limited customization options"),(0,i.yg)("td",{parentName:"tr",align:null},"Extensive customization options through configuration files and APIs")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"Learning Curve"),(0,i.yg)("td",{parentName:"tr",align:null},"Easier to learn for beginners"),(0,i.yg)("td",{parentName:"tr",align:null},"Steeper learning curve for those unfamiliar with command-line tools and C/C++")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"Use Cases"),(0,i.yg)("td",{parentName:"tr",align:null},"Simple IoT projects, prototyping"),(0,i.yg)("td",{parentName:"tr",align:null},"Complex IoT applications, real-time systems, custom hardware")))),(0,i.yg)("h2",{id:"trouble-shooting"},"Trouble Shooting"),(0,i.yg)("p",null,"Some problems might encounter in the process of hardware connection, software debugging or uploading."),(0,i.yg)("h2",{id:"tech-support--product-discussion"},"Tech Support & Product Discussion"),(0,i.yg)("p",null,"Thank you for choosing our products! We are here to provide you with different support to ensure that your experience with our products is as smooth as possible. We offer several communication channels to cater to different preferences and needs."),(0,i.yg)("div",{class:"button_tech_support_container"},(0,i.yg)("a",{href:"https://forum.seeedstudio.com/",class:"button_forum"}),(0,i.yg)("a",{href:"https://www.seeedstudio.com/contacts",class:"button_email"})),(0,i.yg)("div",{class:"button_tech_support_container"},(0,i.yg)("a",{href:"https://discord.gg/eWkprNDMU7",class:"button_discord"}),(0,i.yg)("a",{href:"https://github.com/Seeed-Studio/wiki-documents/discussions/69",class:"button_discussion"})))}p.isMDXComponent=!0}}]);