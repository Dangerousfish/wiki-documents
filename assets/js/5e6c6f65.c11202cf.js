"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[38267],{15680:(e,n,t)=>{t.d(n,{xA:()=>g,yg:()=>m});var i=t(96540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=i.createContext({}),s=function(e){var n=i.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},g=function(e){var n=s(e.components);return i.createElement(p.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),c=s(t),u=a,m=c["".concat(p,".").concat(u)]||c[u]||d[u]||r;return t?i.createElement(m,o(o({ref:n},g),{},{components:t})):i.createElement(m,o({ref:n},g))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,o=new Array(r);o[0]=u;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l[c]="string"==typeof e?e:a,o[1]=l;for(var s=2;s<r;s++)o[s]=t[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},75463:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var i=t(9668),a=(t(96540),t(15680));const r={description:"Introduces how to develop your own set of UI for Watcher, with the help of SquareLine Studio and LVGL.",title:"Watcher UI Integration Guide",image:"https://files.seeedstudio.com/wiki/watcher_software_framework/ui_framework.webp",slug:"/watcher_ui_integration_guide",sidebar_position:4,last_update:{date:"11/5/2024",author:"Citric"}},o="Watcher UI Integration Guide",l={unversionedId:"Sensor/SenseCAP/SenseCAP_Watcher/Firmware_architecture_Overview/watcher_ui_intergration_guide",id:"Sensor/SenseCAP/SenseCAP_Watcher/Firmware_architecture_Overview/watcher_ui_intergration_guide",title:"Watcher UI Integration Guide",description:"Introduces how to develop your own set of UI for Watcher, with the help of SquareLine Studio and LVGL.",source:"@site/docs/Sensor/SenseCAP/SenseCAP_Watcher/Firmware_architecture_Overview/watcher_ui_intergration_guide.md",sourceDirName:"Sensor/SenseCAP/SenseCAP_Watcher/Firmware_architecture_Overview",slug:"/watcher_ui_integration_guide",permalink:"/watcher_ui_integration_guide",draft:!1,editUrl:"https://github.com/Seeed-Studio/wiki-documents/blob/docusaurus-version/docs/Sensor/SenseCAP/SenseCAP_Watcher/Firmware_architecture_Overview/watcher_ui_intergration_guide.md",tags:[],version:"current",lastUpdatedBy:"Citric",lastUpdatedAt:1730764800,formattedLastUpdatedAt:"Nov 5, 2024",sidebarPosition:4,frontMatter:{description:"Introduces how to develop your own set of UI for Watcher, with the help of SquareLine Studio and LVGL.",title:"Watcher UI Integration Guide",image:"https://files.seeedstudio.com/wiki/watcher_software_framework/ui_framework.webp",slug:"/watcher_ui_integration_guide",sidebar_position:4,last_update:{date:"11/5/2024",author:"Citric"}},sidebar:"ProductSidebar",previous:{title:"Watcher Function Module Development Guide",permalink:"/watcher_function_module_development_guide"},next:{title:"Notifications",permalink:"/notifications_with_watcher_main_page"}},p={},s=[{value:"1. <strong>UI Component Structure</strong>",id:"1-ui-component-structure",level:2},{value:"2. <strong>Group Management</strong>",id:"2-group-management",level:2},{value:"2.1 Overview",id:"21-overview",level:3},{value:"2.2 Adding Objects to a Group",id:"22-adding-objects-to-a-group",level:3},{value:"2.3 Page Navigation and Object Management",id:"23-page-navigation-and-object-management",level:3},{value:"2.4 Associating Encoder with Group",id:"24-associating-encoder-with-group",level:3},{value:"2.5 Printing GroupInfo Objects",id:"25-printing-groupinfo-objects",level:3},{value:"2.6 Example Usage",id:"26-example-usage",level:3},{value:"3. Device Alarm",id:"3-device-alarm",level:2},{value:"3.1 Overview",id:"31-overview",level:3},{value:"3.2 Initializing Alarm UI",id:"32-initializing-alarm-ui",level:3},{value:"3.3 Turning On Alarm UI",id:"33-turning-on-alarm-ui",level:3},{value:"3.4 Turning Off Alarm UI",id:"34-turning-off-alarm-ui",level:3},{value:"4. AI Inference Real-time Image Rendering",id:"4-ai-inference-real-time-image-rendering",level:2},{value:"4.1 Overview",id:"41-overview",level:3},{value:"4.2 Initializing Image Preview Function",id:"42-initializing-image-preview-function",level:3},{value:"4.3 Refreshing Preview Image",id:"43-refreshing-preview-image",level:3},{value:"5. UI Message Event Definition",id:"5-ui-message-event-definition",level:2},{value:"5.1 Overview",id:"51-overview",level:3},{value:"5.2 UI Event Handling Functions",id:"52-ui-event-handling-functions",level:3},{value:"5.3 Usage",id:"53-usage",level:3},{value:"1. Declare and Define Events, and Register UI Event Handler Instance to a Specific Loop",id:"1-declare-and-define-events-and-register-ui-event-handler-instance-to-a-specific-loop",level:4},{value:"2. UI Message Event Handling",id:"2-ui-message-event-handling",level:4},{value:"3. Sending UI Message Events",id:"3-sending-ui-message-events",level:4},{value:"6. Application",id:"6-application",level:2},{value:"6.1 Creating UI Objects and Callback Functions in Squareline",id:"61-creating-ui-objects-and-callback-functions-in-squareline",level:3},{value:"6.2 Exporting the <code>ui</code> Project from Squareline",id:"62-exporting-the-ui-project-from-squareline",level:3},{value:"6.3 Implementing Callback Functions Declared in Header Files",id:"63-implementing-callback-functions-declared-in-header-files",level:3},{value:"6.4 Adding Objects to Structure Variables",id:"64-adding-objects-to-structure-variables",level:3},{value:"6.5 UI Initialization",id:"65-ui-initialization",level:3},{value:"6.6 Viewing the Running Effect",id:"66-viewing-the-running-effect",level:3},{value:"7. SquareLine Project",id:"7-squareline-project",level:2},{value:"8. File Description",id:"8-file-description",level:2},{value:"Tech Support &amp; Product Discussion",id:"tech-support--product-discussion",level:2}],g={toc:s},c="wrapper";function d(e){let{components:n,...t}=e;return(0,a.yg)(c,(0,i.A)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"watcher-ui-integration-guide"},"Watcher UI Integration Guide"),(0,a.yg)("h2",{id:"1-ui-component-structure"},"1. ",(0,a.yg)("strong",{parentName:"h2"},"UI Component Structure")),(0,a.yg)("p",null,"In this tutorial, you will learn how to integrate your own UI design and related logic functions into the ",(0,a.yg)("inlineCode",{parentName:"p"},"view")," directory. All UI designs and logic functions will be placed in the ",(0,a.yg)("inlineCode",{parentName:"p"},"view")," directory, which contains the ",(0,a.yg)("inlineCode",{parentName:"p"},"ui")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"ui_manager")," subdirectories. Additionally, the ",(0,a.yg)("inlineCode",{parentName:"p"},"view")," directory includes ",(0,a.yg)("inlineCode",{parentName:"p"},"view.c"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"view_alarm.c"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"view_image_preview.c"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"view_pages.c"),", and corresponding ",(0,a.yg)("inlineCode",{parentName:"p"},".h")," header files. The specific framework is shown below:"),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/watcher_software_framework/ui_framework.png",style:{width:600,height:"auto"}})),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The ",(0,a.yg)("inlineCode",{parentName:"p"},"ui")," subdirectory contains all user-defined UI designs. In this project, the ",(0,a.yg)("inlineCode",{parentName:"p"},"ui")," is generated by the Squareline tool.")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The ",(0,a.yg)("inlineCode",{parentName:"p"},"ui_manager")," subdirectory contains custom animations, object group management, and various event callback definitions.")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The source files starting with ",(0,a.yg)("inlineCode",{parentName:"p"},"view")," define global pages and related event callback functions.")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The UI interacts with the APP layer by sending and listening to events."))),(0,a.yg)("admonition",{type:"tip"},(0,a.yg)("p",{parentName:"admonition"},"Reading the module definitions below will help you understand and use the entire UI framework. If you want to quickly grasp UI integration, you can skip to Chapter 6 for application reading.")),(0,a.yg)("h2",{id:"2-group-management"},"2. ",(0,a.yg)("strong",{parentName:"h2"},"Group Management")),(0,a.yg)("h3",{id:"21-overview"},"2.1 Overview"),(0,a.yg)("p",null,"SenseCAP Watcher supports touchscreen and encoder input devices. To synchronize these input device actions and ensure correctness, group management is required to maintain focus on the correct object and avoid event conflicts."),(0,a.yg)("p",null,"Group management functions are implemented in the following files:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"pm.c"),": Contains function implementations."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"pm.h"),": Contains function prototypes and type definitions.")),(0,a.yg)("h3",{id:"22-adding-objects-to-a-group"},"2.2 Adding Objects to a Group"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"static void addObjToGroup(GroupInfo *groupInfo, lv_obj_t *objects[], int count);\n")),(0,a.yg)("p",null,"Here, ",(0,a.yg)("inlineCode",{parentName:"p"},"groupInfo")," is a pointer to the ",(0,a.yg)("inlineCode",{parentName:"p"},"GroupInfo")," structure to which objects will be added, ",(0,a.yg)("inlineCode",{parentName:"p"},"objects")," is the array of objects to be added to the group, and ",(0,a.yg)("inlineCode",{parentName:"p"},"count")," is the number of objects in the array."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Define the objects to be added to the page\nlv_obj_t *example_objects[] = {example_obj1, example_obj2, ...};\n// Add the objects to the group structure variable\naddObjToGroup(&group_page_example, example_objects, sizeof(example_objects) / sizeof(example_objects[0]));\n")),(0,a.yg)("h3",{id:"23-page-navigation-and-object-management"},"2.3 Page Navigation and Object Management"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"void lv_pm_open_page(lv_group_t *group, \n                      GroupInfo *groupInfo, \n                      pm_operation_t operation, \n                      lv_obj_t **target, \n                      lv_scr_load_anim_t fademode,\n                      int spd, \n                      int delay, \n                      void (*target_init)(void));\n")),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Parameters:")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"group"),": Pointer to the LVGL group."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"groupInfo"),": Pointer to the ",(0,a.yg)("inlineCode",{parentName:"li"},"GroupInfo")," structure containing page objects."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"operation"),": The operation to be performed (add objects to group, no operation, or clear group)."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"target"),": The target object of the new page."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"fademode"),": Screen load animation mode."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"spd"),": Speed of the screen load animation."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"delay"),": Delay before the screen load animation starts."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"target_init"),": Initialization function for the target screen.")),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Add the objects from the structure variable to the group and navigate to the corresponding page\nlv_pm_open_page(g_example, &group_page_example, PM_ADD_OBJS_TO_GROUP, &ui_Page_Example, LV_SCR_LOAD_ANIM_NONE, 0, 0, &ui_Page_Example_screen_init);\n")),(0,a.yg)("h3",{id:"24-associating-encoder-with-group"},"2.4 Associating Encoder with Group"),(0,a.yg)("p",null,"Create a group, iterate to get input devices, and associate the encoder with the group so that the encoder can control the objects in the group."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"void lv_pm_init(void)\n{\n  // Create a group\n  g_main = lv_group_create();\n  cur_drv = NULL;\n  // Loop to get input devices\n  while ((cur_drv = lv_indev_get_next(cur_drv)))\n  {\n    // Associate the encoder with the group when the input device is an encoder\n    if (cur_drv->driver->type == LV_INDEV_TYPE_ENCODER)\n    {\n      lv_indev_set_group(cur_drv, g_main);\n      break;\n    }\n  }\n  // Define objects in different GroupInfo structure variables\n  initGroup();\n}\n")),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Call in `view_init` to initialize the group and associate the encoder with the group\nint view_init(void)\n{\n  // Note: Any operations on objects in the lvgl task must be performed within a thread lock!\n  lvgl_port_lock(0);\n  // Initialize UI\n  ui_init();\n  // Initialize the group and associate the encoder\n  lv_pm_init();\n  lvgl_port_unlock();\n}\n")),(0,a.yg)("h3",{id:"25-printing-groupinfo-objects"},"2.5 Printing GroupInfo Objects"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"static void printGroup(GroupInfo *groupInfo);\n")),(0,a.yg)("p",null,"Here, ",(0,a.yg)("inlineCode",{parentName:"p"},"groupInfo")," is a pointer to the ",(0,a.yg)("inlineCode",{parentName:"p"},"GroupInfo")," structure to which objects will be added. Note that before printing, you need to set the ",(0,a.yg)("inlineCode",{parentName:"p"},"user_data")," for the objects by using ",(0,a.yg)("inlineCode",{parentName:"p"},'lv_obj_set_user_data(example_obj, "example_obj_print")'),"."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"printGroup(&group_page_example);\n")),(0,a.yg)("h3",{id:"26-example-usage"},"2.6 Example Usage"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Define a ",(0,a.yg)("inlineCode",{parentName:"li"},"GroupInfo")," variable")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"GroupInfo group_page_example;\n")),(0,a.yg)("ol",{start:2},(0,a.yg)("li",{parentName:"ol"},"Initialize objects in ",(0,a.yg)("inlineCode",{parentName:"li"},"initGroup()"))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"lv_obj_t * example_objects[] = {example_obj1, example_obj2, ...};\n")),(0,a.yg)("ol",{start:3},(0,a.yg)("li",{parentName:"ol"},"Add objects to the group")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"addObjToGroup(&group_page_example, example_objects, sizeof(example_objects) / sizeof(example_objects[0]));\n")),(0,a.yg)("ol",{start:4},(0,a.yg)("li",{parentName:"ol"},"Open the page and add the group")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"lv_pm_open_page(g_example, &group_page_example, PM_ADD_OBJS_TO_GROUP, &ui_Page_Example, LV_SCR_LOAD_ANIM_NONE, 0, 0, &ui_Page_Example_screen_init);\n")),(0,a.yg)("p",null,"By following these steps, you can ensure that the touchscreen and encoder input operate synchronously and correctly in your application."),(0,a.yg)("h2",{id:"3-device-alarm"},"3. Device Alarm"),(0,a.yg)("h3",{id:"31-overview"},"3.1 Overview"),(0,a.yg)("p",null,"This section explains how to integrate and use the alarm UI components in your Watcher. By understanding and using the following functions, you can manage the device's UI alarm behavior."),(0,a.yg)("p",null,"The alarm UI is implemented in the following files:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"view_alarm.c"),": Contains function implementations."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"view_alarm.h"),": Contains function prototypes and type definitions.")),(0,a.yg)("h3",{id:"32-initializing-alarm-ui"},"3.2 Initializing Alarm UI"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"int view_alarm_init(lv_obj_t *ui_screen);\n")),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"ui_screen")," is a pointer to the screen object used to display the alarm UI components."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Create alarm-related UI on the top layer\nview_alarm_init(lv_layer_top());\n")),(0,a.yg)("h3",{id:"33-turning-on-alarm-ui"},"3.3 Turning On Alarm UI"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"int view_alarm_on(struct tf_module_local_alarm_info *alarm_st);\n")),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"alarm_st")," is a pointer to the ",(0,a.yg)("inlineCode",{parentName:"p"},"tf_module_local_alarm_info")," structure, which contains alarm-related information such as the ",(0,a.yg)("inlineCode",{parentName:"p"},"duration of the alarm"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"whether to display text and images"),", and ",(0,a.yg)("inlineCode",{parentName:"p"},"specific content of the text and images"),"."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"struct tf_module_local_alarm_info info;\nview_alarm_on(&info);\n")),(0,a.yg)("h3",{id:"34-turning-off-alarm-ui"},"3.4 Turning Off Alarm UI"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"void view_alarm_off();\n")),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Hide the alarm-related UI, set corresponding flags, or execute page transition logic\nview_alarm_off();\n")),(0,a.yg)("h2",{id:"4-ai-inference-real-time-image-rendering"},"4. AI Inference Real-time Image Rendering"),(0,a.yg)("h3",{id:"41-overview"},"4.1 Overview"),(0,a.yg)("p",null,"This section explains how to decode images on the device and display them in LVGL."),(0,a.yg)("p",null,"This functionality is implemented in the following files:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"view_image_preview.c"),": Contains function implementations."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"view_image_preview.h"),": Contains function prototypes and type definitions.")),(0,a.yg)("h3",{id:"42-initializing-image-preview-function"},"4.2 Initializing Image Preview Function"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"int view_image_preview_init(lv_obj_t *ui_screen);\n")),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"ui_screen")," is a pointer to the screen object used to display real-time previews. This function initializes the JPEG decoder, allocates memory, and creates some UI objects to render AI inference results, such as target detection boxes and classification names."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Create image preview UI on the ViewLive page\nview_image_preview_init(ui_Page_ViewLive);\n")),(0,a.yg)("h3",{id:"43-refreshing-preview-image"},"4.3 Refreshing Preview Image"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"int view_image_preview_flush(struct tf_module_ai_camera_preview_info *p_info);\n")),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"p_info")," is a pointer to the ",(0,a.yg)("inlineCode",{parentName:"p"},"tf_module_ai_camera_preview_info")," structure, which contains image and AI model inference information."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Usage:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"struct tf_module_ai_camera_preview_info info;\nview_image_preview_flush(&info);\n")),(0,a.yg)("h2",{id:"5-ui-message-event-definition"},"5. UI Message Event Definition"),(0,a.yg)("h3",{id:"51-overview"},"5.1 Overview"),(0,a.yg)("p",null,"The front-end UI of the device needs to interact with back-end APP tasks. By listening to and consuming specific events, various UI updates and page transition logic can be realized. For detailed information on ESP32 event handling, refer to the ",(0,a.yg)("inlineCode",{parentName:"p"},"Event Loop Library")," section in Espressif's official documentation."),(0,a.yg)("p",null,"UI message event handling is implemented in the following files:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"view.c"),": Contains function implementations."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"view.h"),": Contains function prototypes and type definitions."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"data_defs.h"),": Contains enumeration declarations for various event IDs (both front-end and back-end).")),(0,a.yg)("h3",{id:"52-ui-event-handling-functions"},"5.2 UI Event Handling Functions"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"esp_err_t esp_event_handler_instance_register_with( esp_event_loop_handle_t event_loop, \n                                                    esp_event_base_t event_base, \n                                                    int32_t event_id, \n                                                    esp_event_handler_t event_handler, \n                                                    void * event_handler_arg, \n                                                    esp_event_handler_instance_t * instance ) \n")),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Parameters:")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"event_loop"),": Event loop to which this handler function is registered; cannot be NULL."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"event_base"),": Base ID of the event to register the handler for."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"event_id"),": ID of the event to register the handler for."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"event_handler"),": Handler function to call when the event is dispatched."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"event_handler_arg"),": Argument to pass to the handler function in addition to event data."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"instance"),": Event handler instance object associated with the registered handler and data; can be NULL.")),(0,a.yg)("h3",{id:"53-usage"},"5.3 Usage"),(0,a.yg)("h4",{id:"1-declare-and-define-events-and-register-ui-event-handler-instance-to-a-specific-loop"},"1. Declare and Define Events, and Register UI Event Handler Instance to a Specific Loop"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Declaration and definition of VIEW event base\nESP_EVENT_DECLARE_BASE(VIEW_EVENT_BASE);\nesp_event_loop_handle_t app_event_loop_handle;\n// Declare event IDs as an enumeration; in the SenseCAP-Watcher project, this is placed in data_defs.h\nenum {\n    VIEW_EVENT_EXAMPLE\n}\n// Register instance\nESP_ERROR_CHECK(esp_event_handler_instance_register_with(app_event_loop_handle, \n                                                            VIEW_EVENT_BASE, VIEW_EVENT_EXAMPLE, \n                                                            __view_event_handler, NULL, NULL));\n")),(0,a.yg)("h4",{id:"2-ui-message-event-handling"},"2. UI Message Event Handling"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},'static void __view_event_handler(void* handler_args, esp_event_base_t base, int32_t id, void* event_data)\n{\n  // Acquire lvgl thread lock\n  lvgl_port_lock(0);\n  if (base == VIEW_EVENT_BASE) {\n    switch (id) {\n      // Custom event\n      case VIEW_EVENT_EXAMPLE: {\n        ESP_LOGI("ui_event", "VIEW_EVENT_EXAMPLE");\n        // Execute corresponding logic based on the received event\n        break;\n      }\n    }\n  }\n  // Release lvgl thread lock\n  lvgl_port_unlock();\n}\n')),(0,a.yg)("h4",{id:"3-sending-ui-message-events"},"3. Sending UI Message Events"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Send event to trigger corresponding logic\nesp_event_post_to(app_event_loop_handle, VIEW_EVENT_BASE, VIEW_EVENT_EXAMPLE, NULL, 0, pdMS_TO_TICKS(10000));\n")),(0,a.yg)("h2",{id:"6-application"},"6. Application"),(0,a.yg)("p",null,"Now we will integrate a simple UI example into the SenseCAP Watcher device using the functions introduced above. This will involve using Squareline for UI design, defining UI callback events, managing object groups, and more."),(0,a.yg)("h3",{id:"61-creating-ui-objects-and-callback-functions-in-squareline"},"6.1 Creating UI Objects and Callback Functions in Squareline"),(0,a.yg)("p",null,"Create buttons in Squareline, set their names and styles, and assign callback functions to each button. Click ",(0,a.yg)("inlineCode",{parentName:"p"},"ADD EVENT")," in the ",(0,a.yg)("inlineCode",{parentName:"p"},"Events")," section, choose the trigger type for the event, and name the callback function. This completes the creation of UI objects and their related callback functions."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/watcher_software_framework/ui_img1.png",style:{width:800,height:"auto"}})),(0,a.yg)("h3",{id:"62-exporting-the-ui-project-from-squareline"},"6.2 Exporting the ",(0,a.yg)("inlineCode",{parentName:"h3"},"ui")," Project from Squareline"),(0,a.yg)("p",null,"In the application, choose ",(0,a.yg)("inlineCode",{parentName:"p"},"File")," -> ",(0,a.yg)("inlineCode",{parentName:"p"},"Project Settings")," in the navigation bar, and set the ",(0,a.yg)("inlineCode",{parentName:"p"},"UI Files Export Path")," to ",(0,a.yg)("inlineCode",{parentName:"p"},"project_path/ui"),", where ",(0,a.yg)("inlineCode",{parentName:"p"},"project_path")," is the path to the Squareline project. This sets the export path for the UI design."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/watcher_software_framework/ui_img2.png",style:{width:600,height:"auto"}})),(0,a.yg)("p",null,"Next, click ",(0,a.yg)("inlineCode",{parentName:"p"},"Export")," -> ",(0,a.yg)("inlineCode",{parentName:"p"},"Export UI Files")," in the navigation bar to export a directory folder containing all the UI designs."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/watcher_software_framework/ui_img3.png",style:{width:500,height:"auto"}})),(0,a.yg)("h3",{id:"63-implementing-callback-functions-declared-in-header-files"},"6.3 Implementing Callback Functions Declared in Header Files"),(0,a.yg)("p",null,"Import the ",(0,a.yg)("inlineCode",{parentName:"p"},"ui")," folder into the SenseCAP Watcher project, open and refer to the functions declared in ",(0,a.yg)("inlineCode",{parentName:"p"},"ui_events.h")," of the ",(0,a.yg)("inlineCode",{parentName:"p"},"ui")," folder, and implement these functions in ",(0,a.yg)("inlineCode",{parentName:"p"},"ui_events.c")," of the ",(0,a.yg)("inlineCode",{parentName:"p"},"ui_manager")," folder to complete the logic of these callback functions."),(0,a.yg)("p",null,"For example, in ",(0,a.yg)("inlineCode",{parentName:"p"},"ui_events.h"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"void btn1click_cb(lv_event_t * e);\nvoid btn2click_cb(lv_event_t * e);\nvoid btn3click_cb(lv_event_t * e);\n")),(0,a.yg)("p",null,"And the code will be like this in ",(0,a.yg)("inlineCode",{parentName:"p"},"ui_events.c"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},'void btn1click_cb(lv_event_t * e)\n{\n    ESP_LOGI("ui_example", "btn1click_cb");\n    // Define the logic for this object when the clicked event is triggered\n}\n\nvoid btn2click_cb(lv_event_t * e)\n{\n    ESP_LOGI("ui_example", "btn2click_cb");\n    // Define the logic for this object when the clicked event is triggered\n}\n\nvoid btn3click_cb(lv_event_t * e)\n{\n    ESP_LOGI("ui_example", "btn3click_cb");\n    // Define the logic for this object when the clicked event is triggered\n}\n')),(0,a.yg)("h3",{id:"64-adding-objects-to-structure-variables"},"6.4 Adding Objects to Structure Variables"),(0,a.yg)("p",null,"In this step, we need to manage the encoder and the created group. Adding and removing objects to and from the group will enable the encoder to control the objects."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"// Define a GroupInfo variable\nGroupInfo group_page_example;\n// Initialize objects in initGroup()\nlv_obj_t * example_objects[] = {ui_Button1, ui_Button2, ui_Button3};\n// Add objects to the structure variable to facilitate adding objects to the group in different pages\naddObjToGroup(&group_page_example, example_objects, sizeof(example_objects) / sizeof(example_objects[0]));\n")),(0,a.yg)("h3",{id:"65-ui-initialization"},"6.5 UI Initialization"),(0,a.yg)("p",null,"In ",(0,a.yg)("inlineCode",{parentName:"p"},"view_init")," in ",(0,a.yg)("inlineCode",{parentName:"p"},"view.c"),", call ",(0,a.yg)("inlineCode",{parentName:"p"},"ui_init")," to initialize the UI. This way, when the lvgl task thread runs, it can load the designed UI. The default loaded page is the first page designed in Squareline."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},"int view_init(void)\n{\n  // Note: Any operations on objects in the lvgl task must be performed within a thread lock!\n  lvgl_port_lock(0);\n\n  ui_init();\n  lv_pm_init();\n  // There are two ways to add objects to the group\n  // First: Clear the objects in the group and add them to the group one by one\n  lv_group_remove_all_objs(g_example);\n  lv_group_add_obj(ui_Button1);\n  lv_group_add_obj(ui_Button2);\n  lv_group_add_obj(ui_Button3);\n\n  // Second: Add the corresponding objects to the group through the page transition function:\n  lv_pm_open_page(g_example, &group_page_example, PM_ADD_OBJS_TO_GROUP, &ui_Page_Example, LV_SCR_LOAD_ANIM_NONE, 0, 0, &ui_Page_Example_screen_init);\n\n  lvgl_port_unlock();\n\n  // Other initialization code\n}\n")),(0,a.yg)("h3",{id:"66-viewing-the-running-effect"},"6.6 Viewing the Running Effect"),(0,a.yg)("p",null,"Now we have simply implemented UI integration into the project. Next, we can compile and burn the code into the Watcher to see the running effect!"),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/watcher_software_framework/ui_img4.png",style:{width:500,height:"auto"}})),(0,a.yg)("p",null,"As shown above, by clicking the buttons on the page using the touchscreen or the wheel, you can see the corresponding objects triggering callback events in the serial debugging assistant, indicating that the callback functions are working successfully!"),(0,a.yg)("h2",{id:"7-squareline-project"},"7. SquareLine Project"),(0,a.yg)("p",null,"Most of the pages in the SenseCAP-Watcher are created using Squareline. The Squareline tool allows for easy and quick style modifications of various page objects in the Watcher. Therefore, it is highly recommended to use Squareline for UI development and iteration."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/watcher_software_framework/ui_img5.png",style:{width:800,height:"auto"}})),(0,a.yg)("p",null,"As shown in the image above, the pages in the tool are arranged according to the navigation logic. Adjacent pages can be navigated through buttons or other triggerable objects. You can click on the corresponding page and objects to view defined events, making it very simple to modify the styles of different pages and objects, customizing your AI assistant! However, note that the objects and callback events defined in the current pages are bound to the Watcher's APP layer functions. Modifying them may affect the normal operation of the Watcher. It is recommended to only modify the styles of objects, such as color and size, to ensure the Watcher's normal functionality."),(0,a.yg)("h2",{id:"8-file-description"},"8. File Description"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/Seeed-Studio/SenseCAP-Watcher-Firmware/tree/factory_fw/examples/factory_firmware/docs/ui_intergration_demo/SenseCAP-Watcher_example"},(0,a.yg)("inlineCode",{parentName:"a"},"ui_intergration_demo\\SenseCAP-Watcher_example"))," folder contains the complete Squareline project for the SenseCAP-Watcher, including almost all UI resource designs.")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/Seeed-Studio/SenseCAP-Watcher-Firmware/tree/factory_fw/examples/factory_firmware/docs/ui_intergration_demo/ui_intergration_example"},(0,a.yg)("inlineCode",{parentName:"a"},"ui_intergration_demo\\ui_intergration_example"))," folder contains the Squareline project for the example in the Application chapter.")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"The ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/Seeed-Studio/SenseCAP-Watcher-Firmware/tree/factory_fw/examples/factory_firmware/docs/ui_intergration_demo/view"},(0,a.yg)("inlineCode",{parentName:"a"},"ui_intergration_demo\\view"))," folder contains the ",(0,a.yg)("inlineCode",{parentName:"p"},"view")," component for the example in the Application chapter. You can use the example by directly replacing the original ",(0,a.yg)("inlineCode",{parentName:"p"},"view")," in the project."))),(0,a.yg)("h2",{id:"tech-support--product-discussion"},"Tech Support & Product Discussion"),(0,a.yg)("p",null,"Thank you for choosing our products! We are here to provide you with different support to ensure that your experience with our products is as smooth as possible. We offer several communication channels to cater to different preferences and needs."),(0,a.yg)("div",{class:"table-center"},(0,a.yg)("div",{class:"button_tech_support_container"},(0,a.yg)("a",{href:"https://forum.seeedstudio.com/",class:"button_forum"}),(0,a.yg)("a",{href:"https://www.seeedstudio.com/contacts",class:"button_email"})),(0,a.yg)("div",{class:"button_tech_support_container"},(0,a.yg)("a",{href:"https://discord.gg/eWkprNDMU7",class:"button_discord"}),(0,a.yg)("a",{href:"https://github.com/Seeed-Studio/wiki-documents/discussions/69",class:"button_discussion"}))))}d.isMDXComponent=!0}}]);